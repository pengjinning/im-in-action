= IM实战-IM In Action 草稿2
bytedesk(c) 2019 jackning
Version 2.0, 2019-06-19
:doctype: book
:icons: font
:source-highlighter: highlightjs
:sectnums:
:toc: left
:toclevels: 4
:toc-title: IM从0到1
:experimental:
:description: 基于Spring Boot打造即时通讯和WebRTC应用
:keywords: 微服务 SpringBoot SpringCloud
:imagesdir: ./img
:sectlinks:

从零开始构建一套基于微服务的即使通讯系统

== 前言

水平有限,难免有错误疏漏之处,敬请指出

== 通信方式

=== Polling

=== Long-Polling

comet
反向ajax

=== Server-Send-Event

主要用于服务器向客户端广播或推送消息,而不需要任何交互,如新闻摘要/天气预报等

单向: server to client

SSE 与 WebSocket 作用相似，都是建立浏览器与服务器之间的通信渠道，然后服务器向浏览器推送信息。

总体来说，WebSocket 更强大和灵活。因为它是全双工通道，可以双向通信；SSE 是单向通道，只能服务器向浏览器发送，因为流信息本质上就是下载。如果浏览器向服务器发送信息，就变成了另一次 HTTP 请求。

- SSE 使用 HTTP 协议，现有的服务器软件都支持。WebSocket 是一个独立协议。
- SSE 属于轻量级，使用简单；WebSocket 协议相对复杂。
- SSE 默认支持断线重连，WebSocket 需要自己实现。
- SSE 一般只用来传送文本，二进制数据需要编码后传送，WebSocket 默认支持传送二进制数据。
- SSE 支持自定义发送的消息类型。

参考:
https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html[Server-Sent Events 教程]

=== SPDY

=== Long-Link

长连接
tcp
全双工双向通信

=== WebSocket

而传统的轮询方式（即采用http协议不断发送请求）的缺点：

- 浪费流量（http请求头比较大）、
- 浪费资源（没有更新也要请求）、
- 消耗服务器CPU占用（没有信息也要接收请求）。

可以应用于

- 聊天
- 音视频
- 游戏
- 股票行情
- 协作文档编辑

websocket完全是事件驱动的.也就是说,客户端不需要轮询服务器以得到目标资源的最新状态,只需要监听相关的通知即可.

websocket支持处理文本和二进制数据.

Websocket是消息协议/聊天/服务器通知/管道和多路复用协议/自定义协议/紧凑二进制协议和用于与互联网服务器互操作的其他标准协议的很好基础.

image::assets/img/tcp_http_websocket.png[]

- 持续连接(keep-alive)
- 心跳
- 网络状态检测
- 延迟测量

== 通信协议

=== STOMP

- sockjs

=== Socket.io

=== IRC

=== XMPP

=== MQTT

- websub

原名pubsubhubbub

- pubsub机制




== 通信内容


=== json

=== protobuf


== 造轮子篇

=== 私有协议

=== netty

=== 建立长连接

(修路)

=== 定义通信协议

(定义交通规则)

=== 消息格式

(步行/自行车/机动车/装甲车)


=== server

=== android

=== ios

=== web/h5

=== flutter

=== 小程序


=== mars

腾讯开源库

== 其他


=== 音视频

- webrtc

主要用于实时语音和视频聊天,可以用于传输数据.
可以结合webrtc和websocket构建实时应用

- 基本概念

- 应用

* 文本对话

* 实时音视频


=== 安全篇

- https/ssl

- 数据格式

* 文本传输
* 二进制
* protobuf

=== 加密

* 传输加密
* 存储加密
* 端到端加密

=== 压力测试

=== 对接第三方用户系统

=== 总体架构

=== 高性能

=== 高可用









